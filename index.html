<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CatÃ¡logo Mayorista</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-800">
  <header class="bg-white shadow p-4 text-center">
    <h1 class="text-2xl font-bold">CatÃ¡logo Mayorista - Productos Digitales</h1>
  </header>

  <div class="max-w-6xl mx-auto p-4">
    <div class="mb-6 grid grid-cols-1 md:grid-cols-4 gap-4">
      <input id="searchInput" type="text" placeholder="Buscar producto..." class="p-2 border rounded">
      <select id="categoryFilter" class="p-2 border rounded">
        <option value="">Todas las categorÃ­as</option>
      </select>
      <select id="stockFilter" class="p-2 border rounded">
        <option value="">Stock</option>
        <option value="sÃ­">En stock</option>
        <option value="no">Sin stock</option>
      </select>
      <input id="priceRange" type="range" min="0" max="100" value="100" class="w-full">
    </div>

    <div id="catalogo" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
  </div>

  <footer class="bg-white text-center p-4 text-sm text-gray-500">
    Contacto WhatsApp: +51 929809650
  </footer>

  <script>
    const SHEET_URL = "https://docs.google.com/spreadsheets/d/1w1czDKnRvyYkUvRmt98N0EnTRGMqa3b-CyteYEcZZ0Q/gviz/tq?tqx=out:json";

    let productos = [];

    async function cargarDatos() {
      try {
        const res = await fetch(SHEET_URL);
        const text = await res.text();
        const json = JSON.parse(text.substring(47).slice(0, -2));
        const cols = json.table.cols.map(c => c.label);

        productos = json.table.rows.map(row => {
          const obj = {};
          row.c.forEach((cell, i) => {
            const colName = cols[i].trim().toLowerCase();
            obj[colName] = cell && cell.v ? cell.v : "";
          });
          return obj;
        });

        console.log("âœ… Productos cargados:", productos);
        mostrarProductos();
        cargarFiltros();
      } catch (error) {
        console.error("âŒ Error al cargar datos:", error);
      }
    }

    function mostrarProductos() {
      const contenedor = document.getElementById("catalogo");
      const search = document.getElementById("searchInput").value.toLowerCase();
      const categoria = document.getElementById("categoryFilter").value;
      const stock = document.getElementById("stockFilter").value;
      const precioMax = parseFloat(document.getElementById("priceRange").value);

      contenedor.innerHTML = "";

      productos
        .filter(p =>
          (!search || p["producto"].toLowerCase().includes(search)) &&
          (!categoria || p["categoria"] === categoria) &&
          (!stock || p["stock"] === stock) &&
          (!isNaN(precioMax) && parseFloat(p["precio_unidad"]) <= precioMax)
        )
        .forEach(p => {
          const card = document.createElement("div");
          card.className = "bg-white p-4 shadow rounded flex flex-col";

          card.innerHTML = `
            <img src="${p.url_foto}" alt="${p.producto}" class="h-40 object-contain mb-2">
            <h2 class="text-lg font-bold mb-1">${p.producto}</h2>
            <p class="text-sm mb-1 font-semibold">${p.suscripcion}</p>
            <p class="text-sm mb-2">${p.descripcion}</p>
            <ul class="text-sm mb-4">
              <li>ðŸŽ¯ Unidad: $${p["precio_unidad"]}</li>
              <li>ðŸ“¦ ${p["pack_1"]}: $${p["precio_1"]}</li>
              <li>ðŸ“¦ ${p["pack_2"]}: $${p["precio_2"]}</li>
            </ul>
            <div class="grid grid-cols-1 gap-2">
              <a href="https://wa.me/51929809650?text=${encodeURIComponent(`Hola, quiero pedir:\nðŸ›’ ${p.producto}\nâœ… OpciÃ³n: Unidad\nðŸ’² Precio: $${p["precio_unidad"]}`)}" target="_blank" class="whatsapp-button bg-green-500 text-white text-sm py-2 rounded text-center">Comprar Unidad</a>
              <a href="https://wa.me/51929809650?text=${encodeURIComponent(`Hola, quiero pedir:\nðŸ›’ ${p.producto}\nâœ… OpciÃ³n: ${p["pack_1"]}\nðŸ’² Precio: $${p["precio_1"]}`)}" target="_blank" class="whatsapp-button bg-green-600 text-white text-sm py-2 rounded text-center">Comprar ${p["pack_1"]}</a>
              <a href="https://wa.me/51929809650?text=${encodeURIComponent(`Hola, quiero pedir:\nðŸ›’ ${p.producto}\nâœ… OpciÃ³n: ${p["pack_2"]}\nðŸ’² Precio: $${p["precio_2"]}`)}" target="_blank" class="whatsapp-button bg-green-700 text-white text-sm py-2 rounded text-center">Comprar ${p["pack_2"]}</a>
            </div>
          `;

          contenedor.appendChild(card);
        });
    }

    function cargarFiltros() {
      const categorias = [...new Set(productos.map(p => p["categoria"]).filter(Boolean))];
      const select = document.getElementById("categoryFilter");
      categorias.forEach(c => {
        const opt = document.createElement("option");
        opt.value = c;
        opt.textContent = c;
        select.appendChild(opt);
      });
    }

    document.getElementById("searchInput").addEventListener("input", mostrarProductos);
    document.getElementById("categoryFilter").addEventListener("change", mostrarProductos);
    document.getElementById("stockFilter").addEventListener("change", mostrarProductos);
    document.getElementById("priceRange").addEventListener("input", mostrarProductos);

    cargarDatos();
  </script>
</body>
</html>
